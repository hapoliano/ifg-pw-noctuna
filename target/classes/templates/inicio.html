<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Biblioteca Musical | Noctuna</title>
  <link rel="stylesheet" href="/css/inicio.css">
</head>
<body>

<header>
  <div class="logo">üéß Noctuna</div>
  <nav>
    <a href="inicio.html">In√≠cio</a>
    <a href="../Favoritos/Favoritos.html">Favoritas</a>
    <a href="../../../../../tiii-pw3/tiii-pw3/src/main/resources/templates/criador.html">Criador</a>
    <div class="perfil" id="perfil">L
      <div class="menu-perfil" id="menuPerfil">
        <a href="../MinhaConta/minhaconta.html">Minha conta</a>
        <a href="../../../../../tiii-pw3/tiii-pw3/src/main/resources/templates/Login.html">Sair</a>
      </div>
    </div>
  </nav>
</header>

<main>
  <h1>M√öSICAS MAIS OUVIDAS</h1>
  <div class="music-grid">

    <div class="music-card">
      <h3>Largado √†s Tra√ßas</h3>
      <img src="https://i.scdn.co/image/ab6761610000e5eb3bb672b1c2571a88e937ca0a" alt="Largado √†s Tra√ßas">
      <div class="progress-container">
        <span class="timer">00:00</span>
        <input type="range" class="progress-bar" value="0" min="0" max="100">
      </div>
      <button class="play-btn" data-src="/musicas/tracas.mp3"></button>
      <audio></audio>
      <button class="fav-btn"></button>
    </div>

    <div class="music-card">
      <h3>Notifica√ß√£o Preferida</h3>
      <img src="https://cdn-images.dzcdn.net/images/artist/ea589fefdebdefd0624edda903d07672/500x500.jpg" alt="Notifica√ß√£o Preferida">
      <div class="progress-container">
        <span class="timer">00:00</span>
        <input type="range" class="progress-bar" value="0" min="0" max="100">
      </div>
      <button class="play-btn" data-src="/musicas/preferida.mp3"></button>
      <audio></audio>
      <button class="fav-btn"></button>
    </div>

    <div class="music-card">
      <h3>Barulho do Foguete</h3>
      <img src="https://i.scdn.co/image/ab6761610000e5eb3bb672b1c2571a88e937ca0a" alt="Barulho do Foguete">
      <div class="progress-container">
        <span class="timer">00:00</span>
        <input type="range" class="progress-bar" value="0" min="0" max="100">
      </div>
      <button class="play-btn" data-src="/musicas/foguete.mp3"></button>
      <audio></audio>
      <button class="fav-btn"></button>
    </div>

    <div class="music-card">
      <h3>Pulando o Muro</h3>
      <img src="https://cdn-images.dzcdn.net/images/artist/ea589fefdebdefd0624edda903d07672/500x500.jpg" alt="Pulando o Muro">
      <div class="progress-container">
        <span class="timer">00:00</span>
        <input type="range" class="progress-bar" value="0" min="0" max="100">
      </div>
      <button class="play-btn" data-src="/musicas/muro.mp3"></button>
      <audio></audio>
      <button class="fav-btn"></button>
    </div>

  </div>
</main>

<!-- ‚úÖ JAVASCRIPT COMPLETO -->
<script>
  // ===============================
  // üîò MENU DE PERFIL
  // ===============================
  const perfil = document.getElementById('perfil');
  const menuPerfil = document.getElementById('menuPerfil');

  if (perfil && menuPerfil) {
    perfil.addEventListener('click', function(e) {
      e.stopPropagation();
      menuPerfil.classList.toggle('ativo');
    });

    // Fechar menu ao clicar fora
    document.addEventListener('click', function(e) {
      if (!perfil.contains(e.target)) {
        menuPerfil.classList.remove('ativo');
      }
    });

    menuPerfil.addEventListener('click', function(e) {
      e.stopPropagation();
    });
  }

  // ===============================
  // ‚ù§Ô∏è SISTEMA DE FAVORITOS
  // ===============================
  const botoesFavorito = document.querySelectorAll(".fav-btn");

  function salvarFavoritos(favoritos) {
    localStorage.setItem("favoritos", JSON.stringify(favoritos));
  }

  function carregarFavoritos() {
    return JSON.parse(localStorage.getItem("favoritos")) || [];
  }

  function atualizarEstadoFavorito() {
    const favoritos = carregarFavoritos();
    document.querySelectorAll(".music-card").forEach(card => {
      const titulo = card.querySelector("h3").textContent;
      const btn = card.querySelector(".fav-btn");
      if (favoritos.some(f => f.titulo === titulo)) {
        btn.classList.add("favorito");
      } else {
        btn.classList.remove("favorito");
      }
    });
  }

  botoesFavorito.forEach(botao => {
    botao.addEventListener("click", () => {
      const card = botao.closest(".music-card");
      const titulo = card.querySelector("h3").textContent;
      const img = card.querySelector("img").getAttribute("src");
      const src = card.querySelector(".play-btn").getAttribute("data-src");

      let favoritos = carregarFavoritos();
      const jaExiste = favoritos.some(f => f.titulo === titulo);

      if (jaExiste) {
        favoritos = favoritos.filter(f => f.titulo !== titulo);
        botao.classList.remove("favorito");
      } else {
        favoritos.push({ titulo, img, src });
        botao.classList.add("favorito");
      }

      salvarFavoritos(favoritos);
    });
  });

  // ===============================
  // üéµ PLAYER DE M√öSICAS
  // ===============================
  const botoesPlay = document.querySelectorAll(".play-btn");
  let audioAtual = null;

  botoesPlay.forEach(botao => {
    botao.addEventListener("click", () => {
      const card = botao.closest(".music-card");
      const audio = card.querySelector("audio");
      const src = botao.getAttribute("data-src");

      if (!src) return;

      if (audioAtual && audioAtual !== audio) {
        audioAtual.pause();
        audioAtual.closest(".music-card").querySelector(".play-btn").classList.remove("tocando");
      }

      if (audio.src !== src) {
        audio.src = src;
      }

      if (audio.paused) {
        audio.play();
        botao.classList.add("tocando");
        audioAtual = audio;
      } else {
        audio.pause();
        botao.classList.remove("tocando");
        audioAtual = null;
      }
    });
  });

  document.addEventListener("DOMContentLoaded", atualizarEstadoFavorito);
</script>

</body>
</html>
